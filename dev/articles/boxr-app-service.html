<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Box Service-Apps • boxr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Box Service-Apps">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">boxr</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.3.4.99999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/boxr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/boxr-apps.html">Box Apps: Overview</a>
    </li>
    <li>
      <a href="../articles/boxr-app-interactive.html">Box Interactive-Apps</a>
    </li>
    <li>
      <a href="../articles/boxr-app-service.html">Box Service-Apps</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-box/boxr">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Box Service-Apps</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-box/boxr/blob/master/vignettes/boxr-app-service.Rmd"><code>vignettes/boxr-app-service.Rmd</code></a></small>
      <div class="hidden name"><code>boxr-app-service.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"boxr"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">#&gt; boxr: see `vignette("boxr")` on how to authorize to your Box account.</span></a></code></pre></div>
<p>To interact with the Box API, i.e. to use <code>boxr</code>, requires two things:</p>
<ol style="list-style-type: decimal">
<li>A Box-app has to be set up. If an organization administers your Box account, such an app may already exist.</li>
<li>You have to authenticate to the Box-app.</li>
</ol>
<p>You can think of a Box-app as the door through which <code>boxr</code> functions access Box. There are two different types of apps, described in the <a href="./boxr-apps.html">apps overview-vignette</a>.</p>
<p>In this vignette, we discuss the service-app, which is designed for unattended use, e.g. generating a daily report. The service authenticates to this app using a JWT (JSON) token, then accesses Box with the privileges associated to the app (which should be minimal).</p>
<p>How you use this vignette depends on your Box set-up; we cover these situations:</p>
<ol style="list-style-type: decimal">
<li>
<p>Someone in your Box organization has already created the service-app for your purpose. This means that you have been issued a JSON file which contains the JWT authentication-token.</p>
<p>If so, you can start with the <a href="#use">section</a> focused on users.</p>
</li>
<li><p>You may need to associate the app’s service-account with a folder that your user-account can access. There are a couple of ways to do this, discussed in the <a href="#workflow">collaboration-workflow section</a>.</p></li>
<li>
<p>You have to create a Box service-app, meaning you have to (or someone has to) create the JWT authentication-token. This is covered in the <a href="#create">app-creation section</a>.</p>
<p>If your Box account is controlled by an organization, e.g. you use Box at work, the creation and use of Box apps may be controlled by your Box-admin team. If this is the case, you might refer them to this vignette as a part of a request to have an app created or approved.</p>
</li>
</ol>
<div id="use" class="section level2">
<h2 class="hasAnchor">
<a href="#use" class="anchor"></a>Using a Service App</h2>
<p>A service app is often created in support of a single task, e.g. run a set of daily-reports. Because a service-app acts of behalf of the system itself, and because the tokens are portable, it is a common pracatice to limit the scope of <em>a</em> service-app to <em>a</em> single folder or small set of folders. Thus, you might be dealing with multiple service-apps if you are working on multiple projects.</p>
<p>This is why we encourage you to create a directory in your <em>home</em> directory, called <code>.boxr-auth</code>, to contain these tokens.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"fs"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co"># mode 700 restricts access to your account</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw"><a href="http://fs.r-lib.org/reference/create.html">dir_create</a></span>(<span class="st">"~/.boxr-auth"</span>, <span class="dt">mode =</span> <span class="dv">700</span>)</a></code></pre></div>
<p>When you receive JWT (token) file for your first service-app, save it to your local computer as <code>~/.boxr-auth/token.json</code>.</p>
<p>To authenticate to Box using this token:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="../reference/box_auth_service.html">box_auth_service</a></span>()</a></code></pre></div>
<pre><code>boxr: Authenticated using OAuth2 (JWT) as boxr-jwt-ijl (AutomationUser_868610_9SFx0Bq15D@boxdevedition.com, id: 9862360558)</code></pre>
<p>The authentication function <code><a href="../reference/box_auth_service.html">box_auth_service()</a></code> takes <code>token_file</code> as an argument. Its default is the value of the environment variable <code>BOX_TOKEN_FILE</code>; if that does not exist, the default becomes <code>~/.boxr-auth/token.json</code>.</p>
<p>In a (near) future version of boxr, we plan to make it easier to work interactively with multiple service accounts.</p>
<div id="transferring-token-to-rstudio-server" class="section level3">
<h3 class="hasAnchor">
<a href="#transferring-token-to-rstudio-server" class="anchor"></a>Transferring token to RStudio Server</h3>
<p>Service-authentication can be much easier to use than interactive-authentication if you are using a remote machine, e.g. RStudio Server.</p>
<p>As always, keep security in mind. Presumably, if you are using RStudio Server, it is running on a computer over which you (or your institution) has administrative control. This presents a different set of security considerations from the case where you’re using RStudio Cloud, where neither you nor your institution (unless you work for RStudio) has administrative control of the machine. Keep in mind that the token-file allows its bearer the same Box privileges as the service account on the files/folders it has access to.</p>
<p>To transfer a token from your local machine, first create the <code>.boxr-auth</code> directory in your <strong>home</strong> directory on the <em>remote</em> machine:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"fs"</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co"># mode 700 restricts access to your account</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="kw"><a href="http://fs.r-lib.org/reference/create.html">dir_create</a></span>(<span class="st">"~/.boxr-auth"</span>, <span class="dt">mode =</span> <span class="dv">700</span>)</a></code></pre></div>
<p>Then, in the RStudio Server (or Cloud) session, in the <em>Files</em> pane (see figure below): - go to your token directory: hit the <code>...</code> at the right edge, then specify <code>~/.boxr-auth</code> for the directory. - hit the upload button, and specify the token file on your local computer (you need to be able to view “hidden” files).</p>
<p><img src="figures/rstudio-cloud.png" width="100%"></p>
<p>If you are using RStudio Cloud, be mindful to upload the token to your <strong>home</strong> directory, which is nominally private to your account, rather than the <strong>project</strong> directory, which may be shared.</p>
<p>Once the token-file is uploaded, you should be able to run <code><a href="../reference/box_auth_service.html">boxr::box_auth_service()</a></code> on the remote computer and it should <em>just work</em>, like on your local computer.</p>
</div>
</div>
<div id="workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#workflow" class="anchor"></a>Collaboration Workflows</h2>
<p>If you are using a service-app (acting as a service-account), you may also want to interact with the same files using your interactive-app (acting as your user-account). By default, a service-account has access to only its own file-system, and your user-account has access only to its own (differnent) file-system. To solve this problem, you can invite your service-account to collaborate on a folder in your user file-system, or you can invite your user-account to collaborate on a folder in the service file-system. In either case, you can use the function <code><a href="../reference/box_dir_invite.html">box_dir_invite()</a></code>.</p>
<p>Which way you go depends on the purpose of the service.</p>
<ol style="list-style-type: decimal">
<li><p>If the service is strongly associated with a particular user, e.g. “Nate’s service app”, you (Nate) way wish to invite your service-app to collaborate on your (Nate’s) folders.</p></li>
<li><p>If the service is associated with an ongoing task, e.g “daily-report app”, it may be best for the service to keep the files in its filesystem (Nate might win the lottery someday). If Nate wants access to the files, the service-app may “wish” to invite Nate to collaborate on its folders.</p></li>
</ol>
<p>To use <code><a href="../reference/box_dir_invite.html">box_dir_invite()</a></code>, you need four things:</p>
<ol style="list-style-type: decimal">
<li><p>The <code>user_id</code> of the account you are inviting.</p></li>
<li><p>To be authenticated using the “host” account. This can be either the service-account or your user-account.</p></li>
<li><p>The <code>dir_id</code> of the folder you want to share.</p></li>
<li><p>The <code>role</code> (permissions) you would like to assign to the collaborator.</p></li>
</ol>
<p>Here’s a concrete example. I’ll show how I can share a service-account folder with a user, but the process is easily inverted.</p>
<p>First, I’ll need my <code>user_id</code> from my user-account; I can get that by authenticating:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="../reference/box_auth.html">box_auth</a></span>()</a></code></pre></div>
<pre><code>Using `BOX_CLIENT_ID` from environment
Using `BOX_CLIENT_SECRET` from environment
Auto-refreshing stale OAuth token.
boxr: Authenticated using OAuth2 as Ian Lyttle (ijlyttle@ians-email.com, id: 286871517)</code></pre>
<p>I note that my <code>user_id</code> is <code>"286871517"</code>. Next, I’ll authenticate using my service-account:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="../reference/box_auth_service.html">box_auth_service</a></span>()</a></code></pre></div>
<pre><code>boxr: Authenticated using OAuth2 (JWT) as boxr-jwt-ijl (AutomationUser_868610_9SFx0Bq15D@boxdevedition.com, id: 9862360558)</code></pre>
<p>From my service-account, I can take a look at my home-folder:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="../reference/box_ls.html">box_ls</a></span>()</a></code></pre></div>
<pre><code>
box.com remote object list (1 objects)

  Summary of first 1:

         name   type          id size                                              owner
1 daily_bread folder 91350609301  0 B AutomationUser_868610_9SFx0Bq15D@boxdevedition.com


Use as.data.frame() to extract full results.</code></pre>
<p>There, I see that the folder I want to share, <code>daily_bread</code> has <code>dir_id</code> of <code>"91350609301"</code>.</p>
<p>I decide that that I want my user account to act as <code>"co-owner"</code> of this folder, so now I am ready to invite my user-account to collaborate:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="../reference/box_dir_invite.html">box_dir_invite</a></span>(<span class="st">"91350609301"</span>, <span class="dt">user_id =</span> <span class="st">"286871517"</span>, <span class="dt">role =</span> <span class="st">"co-owner"</span>)</a></code></pre></div>
<pre><code>boxr-jwt-ijl (AutomationUser_868610_9SFx0Bq15D@boxdevedition.com) has invited Ian Lyttle (ijlyttle@me.com) to collaborate on folder `daily_bread` as co-owner.</code></pre>
<p>At this point, I’m done. If I want, I can authenticate to my user-account and check that I have access to the folder:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="../reference/box_auth.html">box_auth</a></span>()</a></code></pre></div>
<pre><code>Using `BOX_CLIENT_ID` from environment
Using `BOX_CLIENT_SECRET` from environment
boxr: Authenticated using OAuth2 as Ian Lyttle (ijlyttle@ians-email.com, id: 286871517)</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw"><a href="../reference/box_ls.html">box_ls</a></span>()</a></code></pre></div>
<pre><code>
box.com remote object list (1 objects)

  Summary of first 1:

         name   type          id size                                              owner
1 daily_bread folder 91350609301  0 B AutomationUser_868610_9SFx0Bq15D@boxdevedition.com


Use as.data.frame() to extract full results.</code></pre>
</div>
<div id="create" class="section level2">
<h2 class="hasAnchor">
<a href="#create" class="anchor"></a>Creating a Service App</h2>
<p>Keep in mind that to create or activate a Box App, you may need the approval of your Box-admin team. If you have a personal Box account, <em>you</em> are your Box-admin team.</p>
<p>This material is a summary of the <a href="https://developer.box.com/en/guides/applications/custom-apps/jwt-setup">Box documentation on JWT apps</a>.</p>
<p>Having logged into your account in a browser, start at the <a href="https://app.box.com/developers/console">Box Developers Console</a>.</p>
<div id="create-app" class="section level3">
<h3 class="hasAnchor">
<a href="#create-app" class="anchor"></a>Create App</h3>
<p>Click on the button <strong>Create New App</strong>, which will guide you through four screens to create your new app:</p>
<ol style="list-style-type: decimal">
<li>Select <strong>Custom App</strong>, click <strong>Next</strong>.</li>
<li>Select <strong>OAuth 2.0 with JWT (Server authentication)</strong>, click <strong>Next</strong>.</li>
<li>Choose a unique name for your app (this can be anything), click <strong>Next</strong>.</li>
<li>Success! Click <strong>View Your App</strong>.</li>
</ol>
<p><img src="figures/interactive-four-steps.png" width="100%"></p>
</div>
<div id="set-oauth2-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#set-oauth2-parameters" class="anchor"></a>Set OAuth2 Parameters</h3>
<p><strong>View Your App</strong> will take you to the <strong>Box Developers Console</strong>.</p>
<p>You will be in the <strong>Configuration</strong> sub-menu by default:</p>
<ol style="list-style-type: decimal">
<li>As you scroll down, at <strong>OAuth 2.0 Credentials</strong>, note the <code>client_id</code> as you will need it to authorize the app.</li>
<li>Choose the <strong>Application Access</strong> to be <strong>Application</strong>. This limits the scope of the app to the service account.</li>
</ol>
<p><img src="figures/service-config-1.png" width="100%"></p>
<p>Scroll down again:</p>
<ol style="list-style-type: decimal">
<li>For <strong>Application Scopes</strong>, restrict these to the first two choices, which limit your app to the Box filesystem.</li>
<li>For <strong>Advanced Features</strong>, make sure these are <strong>not</strong> activated.</li>
<li>
<strong>Save Changes</strong>.</li>
</ol>
<p>This is for security, to make sure that your app has the only <em>minimum</em> capabilities it will need.</p>
<p><img src="figures/service-config-2.png" width="100%"></p>
<p>The next action requires two-factor authentication. If two-factor authentication is not enabled on your Box account, you will need to enable it to proceed.</p>
<ol style="list-style-type: decimal">
<li>In <strong>Add and Manage Public Keys</strong>, click <strong>Generate a Public/Private Keypair</strong>.</li>
</ol>
<p>This should trigger a JSON file to download via your browser, named something like <code>"125699595_j41llffp_config.json"</code>. Following the advice given in the <a href="#use">usage section</a>, save this to a special directory in your <strong>home</strong> directory, e.g. <code>~/.boxr-auth</code>. You may want to give the file a descriptive name, e.g. <code>token.json</code>.</p>
<p>This token file should be kept securely, as the token lets you act with all the privileges of the server-app.</p>
<p><img src="figures/service-config-3.png" width="100%"></p>
</div>
<div id="authorize-app" class="section level3">
<h3 class="hasAnchor">
<a href="#authorize-app" class="anchor"></a>Authorize App</h3>
<p>The last step is to authorize your app - this has to be done by someone on your Box-admin team. If this is a personal account, that’s you. Go to your <a href="https://app.box.com/master/settings/openbox">Apps Setup page</a>:</p>
<ol style="list-style-type: decimal">
<li><p>Scroll down to <strong>Custom Applications</strong>, click <strong>Authorize New App</strong>.</p></li>
<li><p>Enter the <code>client_id</code> for your service-app (which you noted from above). This also can be found in the your token-file, e.g. <code>token.json</code>. Click <strong>Next</strong>.</p></li>
<li><p>Click <strong>Authorize</strong>.</p></li>
</ol>
<p>At this point, you are ready to <a href="#use">use the service-app</a>.</p>
<p><img src="figures/service-authorize.png" width="100%"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#use">Using a Service App</a></li>
      <li><a href="#workflow">Collaboration Workflows</a></li>
      <li><a href="#create">Creating a Service App</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Brendan Rocks, Ian Lyttle, Nate Day.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
