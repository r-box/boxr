<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Design Philosophy • boxr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Design Philosophy">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-secondary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">boxr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.3.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/boxr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Box Apps</h6></li>
    <li><a class="dropdown-item" href="../articles/boxr-apps.html">Box Apps: Overview</a></li>
    <li><a class="dropdown-item" href="../articles/boxr-app-interactive.html">Box Interactive-Apps</a></li>
    <li><a class="dropdown-item" href="../articles/boxr-app-service.html">Box Service-Apps</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/design.html">Design Philosophy</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-box/boxr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Design Philosophy</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-box/boxr/blob/main/vignettes/design.Rmd" class="external-link"><code>vignettes/design.Rmd</code></a></small>
      <div class="d-none name"><code>design.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://tibble.tidyverse.org/" class="external-link">"tibble"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://jeroen.r-universe.dev/jsonlite" class="external-link">"jsonlite"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://purrr.tidyverse.org/" class="external-link">"purrr"</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'purrr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:jsonlite':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     flatten</span></span></code></pre></div>
<p>The audience for this article is the developers of
<strong>boxr</strong>, who may let many weeks or months pass without
actively thinking about how the functions in this package:</p>
<ul>
<li>
<em>are</em> set up; there is some variation here</li>
<li>
<em>could be</em> set up; Ian still argues with himself here,
approaching with a different view every time he works on this
repository.</li>
</ul>
<p>At its heart, the goal of this package is to abstract away the
complexities of using the Box API. We assume that a new user starts
using this package with some familiarity with the Tidyverse, and r-lib
packages like <strong>fs</strong>, so we aim to provide them with a
familiar way of doing things.</p>
<p>Providing familiarity, particularly to emulate an opinionated
framework like Tidyverse, requires us (as boxr developers) to introduce
opinions. Thus, we also wish provide an “escape hatch”, which could be
used by those who want to work outside of the Tidyverse, or outside of
our opinions.</p>
<p>In Tidyverse, the base unit of analysis is the data frame. Among the
boxr’s developers, it is uncontroversial that we should use data frames
as much as possible. However, data frames come in different flavors:</p>
<ul>
<li>use <strong>tibble</strong>, or no.</li>
<li>use nested data frames, or no.</li>
</ul>
<div class="section level2">
<h2 id="detour-into-postels-law">Detour into Postel’s Law<a class="anchor" aria-label="anchor" href="#detour-into-postels-law"></a>
</h2>
<p>I (Ian) am a firm believer that following Postel’s Law helps us (and
our users) avoid hard-to-diagnose trouble. As you may know, Postel’s law
says to be “flexible in what you accept; strict in what you return”. In
other words, we should strive to accept and interpret users’ input so
long as the intent is clear, but we should specify very clearly what a
function returns and adhere strictly to that specification.</p>
<p>A famous Tidyverse example is how a subsetting a
<code>data.frame</code> will, by default, return a <code>vector</code>
rather than a <code>data.frame</code> if only one column is
specified:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wt"</span>, <span class="st">"mpg"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    32 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;  $ wt : num  2.62 2.88 2.32 3.21 3.44 ...</span></span>
<span><span class="co">#&gt;  $ mpg: num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span>, <span class="st">"mpg"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;  num [1:32] 21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...</span></span></code></pre></div>
<p>To avoid this behavior you can specify <code>drop = FALSE</code>, but
this is sometimes forgotten – even by experienced R users:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span>, <span class="st">"mpg"</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    32 obs. of  1 variable:</span></span>
<span><span class="co">#&gt;  $ mpg: num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...</span></span></code></pre></div>
<p>The tibble designs this problem away. Following Postel’s law, a
subsetting a tibble <em>always</em> returns a tibble; if you want a
vector, you have to call another function. It is strict with its
output.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span><span class="op">[</span>, <span class="st">"mpg"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [32 × 1] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ mpg: num [1:32] 21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...</span></span></code></pre></div>
<p>As we figure out what our functions return, I want to keep Postel’s
Law in mind.</p>
</div>
<div class="section level2">
<h2 id="box-api">Box API<a class="anchor" aria-label="anchor" href="#box-api"></a>
</h2>
<p>The boxr package is an exercise in abstracting away the Box API;
sometimes this abstraction helps developers like me forget that it is
actually there. It’s <a href="https://developer.box.com/reference/" class="external-link">there</a>.</p>
<p>The API is classified according to <em>endpoints</em> and
<em>resources</em>; I think of these as analogous to R
<em>functions</em> and <em>objects</em>. The Box API is comprehensive;
we cannot possibly aspire to cover it all. Instead, our goal is to
provide easy access to as many day-to-day endpoints as we can, and
provide a way to help <em>you</em> to access others if you need to.</p>
<p>Some of our functions call to only one endpoint,
e.g. <code><a href="../reference/box_ls.html">box_ls()</a></code> calls only the <a href="https://developer.box.com/reference/get-folders-id-items/#request" class="external-link">list
items in folder endpoint</a>. Others of our functions call multiple
endpoints, e.g <code><a href="../reference/box_fetch.html">box_fetch()</a></code> calls the list-items endpoint,
as well as the <a href="https://developer.box.com/reference/get-files-id-content/" class="external-link">download
file endpoint</a>.</p>
<p>If a function calls a single endpoint (perhaps even repeatedly), it
should return the response (or collection of responses) that the API
returns. Consider the content of a sample response from the <a href="https://developer.box.com/reference/resources/items/" class="external-link">list-items
endpoint</a>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">content</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span></span>
<span>    <span class="st">'{</span></span>
<span><span class="st">      "entries": [</span></span>
<span><span class="st">        {</span></span>
<span><span class="st">          "id": "12345",</span></span>
<span><span class="st">          "etag": "1",</span></span>
<span><span class="st">          "type": "file",</span></span>
<span><span class="st">          "sequence_id": "3",</span></span>
<span><span class="st">          "name": "Contract.pdf",</span></span>
<span><span class="st">          "sha1": "85136C79CBF9FE36BB9D05D0639C70C265C18D37",</span></span>
<span><span class="st">          "file_version": {</span></span>
<span><span class="st">            "id": "12345",</span></span>
<span><span class="st">            "type": "file_version",</span></span>
<span><span class="st">            "sha1": "134b65991ed521fcfe4724b7d814ab8ded5185dc"</span></span>
<span><span class="st">          }</span></span>
<span><span class="st">        }</span></span>
<span><span class="st">      ],</span></span>
<span><span class="st">      "limit": 1000,</span></span>
<span><span class="st">      "offset": 2000,</span></span>
<span><span class="st">      "order": [</span></span>
<span><span class="st">        {</span></span>
<span><span class="st">          "by": "type",</span></span>
<span><span class="st">          "direction": "ASC"</span></span>
<span><span class="st">        }</span></span>
<span><span class="st">      ],</span></span>
<span><span class="st">      "total_count": 5000</span></span>
<span><span class="st">    }'</span>,</span>
<span>    simplifyVector <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The sample response shown on the Box web-page is different from the
response that I actually get. The example JSON, in the
<code>"entries"</code> element, does not quote numeric values,
e.g. <code>{"id": 0}</code>, whereas the <em>actual</em> response does
quote numeric values, e.g. <code>{"id": "0"}</code>.</p>
<p>While this may seem inconvenient, it may help us out because although
elements like file <code>id</code> are nominally integers, they are
often larger than R’s integer-maximum. For this reason, I think that
from boxr’s perspective, <code>id</code> should remain a character
string. That said, I think we can parse other things:</p>
<ul>
<li>other, smaller, numbers as integers, in this case
<code>"etag"</code>, <code>"sequence_id"</code>.</li>
<li>datetimes, these are elements that seem to end with
<code>"_at"</code>.</li>
<li>logicals; these are elements that seem to start with
<code>"is_"</code>, <code>"can_"</code>, or <code>"has_"</code>.</li>
</ul>
<p>Here’s the parsed content.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">content</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ entries    :List of 1</span></span>
<span><span class="co">#&gt;   ..$ :List of 7</span></span>
<span><span class="co">#&gt;   .. ..$ id          : chr "12345"</span></span>
<span><span class="co">#&gt;   .. ..$ etag        : chr "1"</span></span>
<span><span class="co">#&gt;   .. ..$ type        : chr "file"</span></span>
<span><span class="co">#&gt;   .. ..$ sequence_id : chr "3"</span></span>
<span><span class="co">#&gt;   .. ..$ name        : chr "Contract.pdf"</span></span>
<span><span class="co">#&gt;   .. ..$ sha1        : chr "85136C79CBF9FE36BB9D05D0639C70C265C18D37"</span></span>
<span><span class="co">#&gt;   .. ..$ file_version:List of 3</span></span>
<span><span class="co">#&gt;   .. .. ..$ id  : chr "12345"</span></span>
<span><span class="co">#&gt;   .. .. ..$ type: chr "file_version"</span></span>
<span><span class="co">#&gt;   .. .. ..$ sha1: chr "134b65991ed521fcfe4724b7d814ab8ded5185dc"</span></span>
<span><span class="co">#&gt;  $ limit      : int 1000</span></span>
<span><span class="co">#&gt;  $ offset     : int 2000</span></span>
<span><span class="co">#&gt;  $ order      :List of 1</span></span>
<span><span class="co">#&gt;   ..$ :List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ by       : chr "type"</span></span>
<span><span class="co">#&gt;   .. ..$ direction: chr "ASC"</span></span>
<span><span class="co">#&gt;  $ total_count: int 5000</span></span></code></pre></div>
<p>In the <code>content</code> list, only the <code>entries</code>
element has lasting information; the other elements deal with the
pagination.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we could imagine this as a function that would contain all our parsing rules</span></span>
<span><span class="va">parse_entry</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">entry</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># if we import tidyselect, we can use functions like `ends_with()`</span></span>
<span>  <span class="va">entry</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_if.html" class="external-link">map_at</a></span><span class="op">(</span><span class="va">entry</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"etag"</span>, <span class="st">"sequence_id"</span><span class="op">)</span>, <span class="va">as.numeric</span><span class="op">)</span></span>
<span>  <span class="va">entry</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_if.html" class="external-link">map_if</a></span><span class="op">(</span><span class="va">entry</span>, <span class="va">is.list</span>, <span class="va">parse_entry</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">entry</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">entries</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">content</span><span class="op">$</span><span class="va">entries</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">parse_entry</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">entries</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ :List of 7</span></span>
<span><span class="co">#&gt;   ..$ id          : chr "12345"</span></span>
<span><span class="co">#&gt;   ..$ etag        : num 1</span></span>
<span><span class="co">#&gt;   ..$ type        : chr "file"</span></span>
<span><span class="co">#&gt;   ..$ sequence_id : num 3</span></span>
<span><span class="co">#&gt;   ..$ name        : chr "Contract.pdf"</span></span>
<span><span class="co">#&gt;   ..$ sha1        : chr "85136C79CBF9FE36BB9D05D0639C70C265C18D37"</span></span>
<span><span class="co">#&gt;   ..$ file_version:List of 3</span></span>
<span><span class="co">#&gt;   .. ..$ id  : chr "12345"</span></span>
<span><span class="co">#&gt;   .. ..$ type: chr "file_version"</span></span>
<span><span class="co">#&gt;   .. ..$ sha1: chr "134b65991ed521fcfe4724b7d814ab8ded5185dc"</span></span></code></pre></div>
<p>Here’s where things get interesting.</p>
<p>As it stands, many of boxr’s functions, e.g <code><a href="../reference/box_ls.html">box_ls()</a></code>
will return the <code>entries</code> as a list of lists, attaching the
S3 class <code>boxr_object_list</code>. It is minimally processed,
allowing you to do with it as you please.</p>
<p>This S3 class has an <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> method which will
convert the element into a data frame. (If you want a data frame 99% of
the time, it is inconvenient to call <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> 99% of
the time.)</p>
<p>It behaves much like the internal function we have,
<code>stack_rows_df()</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">boxr</span><span class="fu">:::</span><span class="fu">stack_rows_df</span><span class="op">(</span><span class="va">entries</span><span class="op">)</span></span>
<span><span class="co">#&gt;      id etag type sequence_id         name</span></span>
<span><span class="co">#&gt; 1 12345    1 file           3 Contract.pdf</span></span>
<span><span class="co">#&gt;                                       sha1 file_version.id file_version.type</span></span>
<span><span class="co">#&gt; 1 85136C79CBF9FE36BB9D05D0639C70C265C18D37           12345      file_version</span></span>
<span><span class="co">#&gt;                          file_version.sha1</span></span>
<span><span class="co">#&gt; 1 134b65991ed521fcfe4724b7d814ab8ded5185dc</span></span></code></pre></div>
<p>For those who prefer tibbles, we have another function,
<code>stack_rows_tbl()</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">boxr</span><span class="fu">:::</span><span class="fu">stack_rows_tbl</span><span class="op">(</span><span class="va">entries</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 7</span></span></span>
<span><span class="co">#&gt;   id     etag type  sequence_id name         sha1                   file_version</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 12345     1 file            3 Contract.pdf 85136C79CBF9FE36BB9D0… <span style="color: #949494;">&lt;named list&gt;</span></span></span></code></pre></div>
<p>A couple of things you might notice:</p>
<ul>
<li><p><code>stack_rows_df()</code> returns a <code>data.frame</code>.
List items are unnested; the nested item names are delimited with a
<code>.</code>, e.g. <code>file_version.id</code>.</p></li>
<li><p><code>stack_rows_tbl()</code> returns a tibble. List items remain
nested.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="boxr-functions">boxr functions<a class="anchor" aria-label="anchor" href="#boxr-functions"></a>
</h2>
<p>Right now, we have a few different ways to deal with return
objects:</p>
<ul>
<li>
<code><a href="../reference/box_version_history.html">box_version_history()</a></code>: calls a single endpoint, returns
a data frame, but we modify the columns: combining <code>type</code> and
<code>id</code> into <code>version_id</code>.</li>
<li>
<code><a href="../reference/box_collab_create.html">box_collab_create()</a></code>: calls a single endpoint, returns a
list with an S3 class <code>"boxr_collab"</code>. This S3 class has an
<code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> method, and an <code><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble()</a></code>
method.</li>
<li>
<code><a href="../reference/box_ls.html">box_ls()</a></code>: calls a single endpoint, returns a list with
an S3 class <code>"boxr_object_list"</code>. This S3 class has an
<code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> method.</li>
<li>
<code><a href="../reference/box_fetch.html">box_fetch()</a></code>: calls multiple endpoints, returns a list
with an S3 class <code>"boxr_dir_wide_operation_result"</code>. This S3
class does not have an <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> method.</li>
</ul>
<p>The goal is to find a way to harmonize this, without causing too many
backward incompatibilities.</p>
</div>
<div class="section level2">
<h2 id="ideas-for-how-to-proceed">Ideas for how to proceed<a class="anchor" aria-label="anchor" href="#ideas-for-how-to-proceed"></a>
</h2>
<p>I’m thinking out loud here to sketch out ways to proceed so that we
provide a consistent return object:</p>
<ul>
<li>day-to-day users receive a data-frame-like return object, in some
“optimally-wrangled” form.</li>
<li>other users can emulate the process and get the information they
need.</li>
</ul>
<p>We will walk through a simplified reimagining of the
<code><a href="../reference/box_ls.html">box_ls()</a></code> function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://r-box.github.io/boxr/">"boxr"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/box_auth.html">box_auth</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>Using `BOX_CLIENT_ID` from environment
Using `BOX_CLIENT_SECRET` from environment
boxr: Authenticated using OAuth2 as Ian LYTTLE (ian.lyttle@se.com, id: 196942982)</code></pre>
<div class="section level3">
<h3 id="single-function-to-call-the-api">Single function to call the API<a class="anchor" aria-label="anchor" href="#single-function-to-call-the-api"></a>
</h3>
<p>Let’s imagine a single function in the package that calls the API. It
will be more involved than this, but it will give you an idea.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># this works for Ian's Box account - no-one else</span></span>
<span><span class="va">dir_id</span> <span class="op">&lt;-</span> <span class="st">"123053109701"</span></span>
<span></span>
<span><span class="co"># returns a httr response object</span></span>
<span><span class="va">box_api_response</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">verb</span>, <span class="va">endpoint</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">response</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/RETRY.html" class="external-link">RETRY</a></span><span class="op">(</span></span>
<span>      <span class="va">verb</span>,</span>
<span>      <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"https://api.box.com/2.0/{endpoint}"</span><span class="op">)</span>,</span>
<span>      <span class="fu">boxr</span><span class="fu">:::</span><span class="fu">get_token</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      terminate_on <span class="op">=</span> <span class="fu">boxr</span><span class="fu">:::</span><span class="fu">box_terminal_http_codes</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">response</span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">response</span> <span class="op">&lt;-</span> <span class="fu">box_api_response</span><span class="op">(</span><span class="st">"GET"</span>, <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"folders/{dir_id}/items/"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">response</span></span></code></pre></div>
<pre><code>Response [https://api.box.com/2.0/folders/123053109701/items/]
  Date: 2020-10-17 01:04
  Status: 200
  Content-Type: application/json
  Size: 640 B</code></pre>
</div>
<div class="section level3">
<h3 id="extract-content">Extract content<a class="anchor" aria-label="anchor" href="#extract-content"></a>
</h3>
<p>At this point, we have no idea if the response is any good or not,
nor have we extracted the content.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">box_content</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">response</span>, <span class="va">task</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/stop_for_status.html" class="external-link">stop_for_status</a></span><span class="op">(</span><span class="va">response</span>, task <span class="op">=</span> <span class="va">task</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">text</span> <span class="op">&lt;-</span> <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/content.html" class="external-link">content</a></span><span class="op">(</span><span class="va">response</span>, as <span class="op">=</span> <span class="st">"text"</span>, encoding <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># we may want to deviate from the defaults</span></span>
<span>  <span class="va">content</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="va">text</span>, simplifyDataFrame <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">content</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This lets someone get a JSON list, or an error message if the
response is bad.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">content</span> <span class="op">&lt;-</span> <span class="fu">box_content</span><span class="op">(</span><span class="va">response</span>, task <span class="op">=</span> <span class="st">"get directory listing"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">content</span><span class="op">)</span></span></code></pre></div>
<pre><code>List of 5
 $ total_count: int 2
 $ entries    :List of 2
  ..$ :List of 7
  .. ..$ type        : chr "file"
  .. ..$ id          : chr "721629732867"
  .. ..$ file_version:List of 3
  .. .. ..$ type: chr "file_version"
  .. .. ..$ id  : chr "767453805267"
  .. .. ..$ sha1: chr "c66f70f6c65f8cd381434a56165640d50fb3a9c2"
  .. ..$ sequence_id : chr "0"
  .. ..$ etag        : chr "0"
  .. ..$ sha1        : chr "c66f70f6c65f8cd381434a56165640d50fb3a9c2"
  .. ..$ name        : chr "another-attempt-at-dark-mode.pdf"
  ..$ :List of 7
  .. ..$ type        : chr "file"
  .. ..$ id          : chr "721628453889"
  .. ..$ file_version:List of 3
  .. .. ..$ type: chr "file_version"
  .. .. ..$ id  : chr "767454763288"
  .. .. ..$ sha1: chr "69ad086c3f8d96b991b8f8bcce67b95708397b1a"
  .. ..$ sequence_id : chr "2"
  .. ..$ etag        : chr "2"
  .. ..$ sha1        : chr "69ad086c3f8d96b991b8f8bcce67b95708397b1a"
  .. ..$ name        : chr "ctz-widget.txt"
 $ offset     : int 0
 $ limit      : int 100
 $ order      :List of 2
  ..$ :List of 2
  .. ..$ by       : chr "type"
  .. ..$ direction: chr "ASC"
  ..$ :List of 2
  .. ..$ by       : chr "name"
  .. ..$ direction: chr "ASC"</code></pre>
</div>
<div class="section level3">
<h3 id="parse-content">Parse content<a class="anchor" aria-label="anchor" href="#parse-content"></a>
</h3>
<p>Now, it may be interesting to parse the content into a list. We can
use the <code>parse_entry()</code> function from above. Note that some
endpoints return an <code>entries</code> element, others don’t. This one
does.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">box_parse_entries</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">entries</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">entries</span>, <span class="va">parse_entry</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">parsed</span> <span class="op">&lt;-</span> <span class="fu">box_parse_entries</span><span class="op">(</span><span class="va">content</span><span class="op">$</span><span class="va">entries</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">parsed</span><span class="op">)</span></span></code></pre></div>
<pre><code>List of 2
 $ :List of 7
  ..$ type        : chr "file"
  ..$ id          : chr "721629732867"
  ..$ file_version:List of 3
  .. ..$ type: chr "file_version"
  .. ..$ id  : chr "767453805267"
  .. ..$ sha1: chr "c66f70f6c65f8cd381434a56165640d50fb3a9c2"
  ..$ sequence_id : num 0
  ..$ etag        : num 0
  ..$ sha1        : chr "c66f70f6c65f8cd381434a56165640d50fb3a9c2"
  ..$ name        : chr "another-attempt-at-dark-mode.pdf"
 $ :List of 7
  ..$ type        : chr "file"
  ..$ id          : chr "721628453889"
  ..$ file_version:List of 3
  .. ..$ type: chr "file_version"
  .. ..$ id  : chr "767454763288"
  .. ..$ sha1: chr "69ad086c3f8d96b991b8f8bcce67b95708397b1a"
  ..$ sequence_id : num 2
  ..$ etag        : num 2
  ..$ sha1        : chr "69ad086c3f8d96b991b8f8bcce67b95708397b1a"
  ..$ name        : chr "ctz-widget.txt"</code></pre>
</div>
<div class="section level3">
<h3 id="stack-in-tabular-form">Stack in tabular form<a class="anchor" aria-label="anchor" href="#stack-in-tabular-form"></a>
</h3>
<p>The parsed content (here at least) is a list of lists. We can stack
this into a tibble from the parsed info:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu">boxr</span><span class="fu">:::</span><span class="fu">stack_rows_tbl</span><span class="op">(</span><span class="va">parsed</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl</span></span></code></pre></div>
<pre><code># A tibble: 2 x 7
  type  id        file_version   sequence_id  etag sha1                    name               
  &lt;chr&gt; &lt;chr&gt;     &lt;list&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;chr&gt;              
1 file  72162973… &lt;named list […           0     0 c66f70f6c65f8cd381434a… another-attempt-at…
2 file  72162845… &lt;named list […           2     2 69ad086c3f8d96b991b8f8… ctz-widget.txt </code></pre>
</div>
<div class="section level3">
<h3 id="wrangle">Wrangle<a class="anchor" aria-label="anchor" href="#wrangle"></a>
</h3>
<p>For this function, we do not propose any post-processing of the
stacked content. However, <code><a href="../reference/box_version_history.html">box_version_history()</a></code> does this:
combining <code>type</code> and <code>id</code> into
<code>version_id</code>.</p>
</div>
<div class="section level3">
<h3 id="all-together">All together<a class="anchor" aria-label="anchor" href="#all-together"></a>
</h3>
<p>We now have the building blocks for our reimagined
<code><a href="../reference/box_ls.html">box_ls()</a></code> function:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">box_dir_info</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dir_id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">response</span> <span class="op">&lt;-</span> <span class="fu">box_api_response</span><span class="op">(</span><span class="st">"GET"</span>, <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"folders/{dir_id}/items/"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">entries</span> <span class="op">&lt;-</span> <span class="fu">box_content</span><span class="op">(</span><span class="va">response</span>, task <span class="op">=</span> <span class="st">"get directory listing"</span><span class="op">)</span><span class="op">[[</span><span class="st">"entries"</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># The above is an oversimplification. In actuality, these two functions </span></span>
<span>  <span class="co"># would be combined into one function that would take care of the pagination, </span></span>
<span>  <span class="co"># something like:</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># entries &lt;- </span></span>
<span>  <span class="co">#  box_api_entries(</span></span>
<span>  <span class="co">#    "GET", </span></span>
<span>  <span class="co">#     endpoint = glue::glue("folders/{dir_id}/items/"),</span></span>
<span>  <span class="co">#     task = "get directory listing"</span></span>
<span>  <span class="co">#  )</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># box_api_entries() would call box_api_response() and box_content()</span></span>
<span>  </span>
<span>  <span class="va">parsed</span> <span class="op">&lt;-</span> <span class="fu">box_parse_entries</span><span class="op">(</span><span class="va">entries</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">stacked</span> <span class="op">&lt;-</span> <span class="fu">boxr</span><span class="fu">:::</span><span class="fu">stack_rows_tbl</span><span class="op">(</span><span class="va">parsed</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># not doing anything here, but box_version_history() changes some columns</span></span>
<span>  <span class="va">wrangled</span> <span class="op">&lt;-</span> <span class="va">stacked</span></span>
<span>  </span>
<span>  <span class="va">wrangled</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">box_dir_info</span><span class="op">(</span><span class="va">dir_id</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 2 x 7
  type  id        file_version   sequence_id  etag sha1                    name               
  &lt;chr&gt; &lt;chr&gt;     &lt;list&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;chr&gt;              
1 file  72162973… &lt;named list […           0     0 c66f70f6c65f8cd381434a… another-attempt-at…
2 file  72162845… &lt;named list […           2     2 69ad086c3f8d96b991b8f8… ctz-widget.txt </code></pre>
<p>There are five distinct steps, each of which could be adapted to
particular circumstances, each of which could be exposed to the user so
they can “roll their own”:</p>
<ul>
<li><p>get the response from the Box API.</p></li>
<li><p>check the response and extract the content.</p></li>
<li><p>parse the content (convert strings to datetimes, etc.).</p></li>
<li><p>stack the parsed content into a canonical tabular form (data
frame or tibble).</p></li>
<li><p>wrangle the stacked content (rename columns, etc.).</p></li>
</ul>
<p>Also, there would be three “families” of functions:</p>
<ul>
<li>those that make potentially multiple calls to a single endpoint, but
response has <code>entries</code> (implying pagination),
e.g. <code><a href="../reference/box_ls.html">box_ls()</a></code>.</li>
<li>those that make a single call to a single endpoint,
e.g. <code><a href="../reference/box_collab_create.html">box_collab_create()</a></code>.</li>
<li>those that make all sorts of calls to all sorts of endpoints,
e.g. <code><a href="../reference/box_fetch.html">box_fetch()</a></code>.</li>
</ul>
<p>The point of this vignette, in its current form, is to sketch out how
the first two families might work. The third family will require more
consideration and considerably more coffee.</p>
<p>This could simplify the creation of new box functions, and perhaps
let us simplify some existing ones. We could export
<code>box_api_response()</code>, <code>box_content()</code>,
<code>box_parse_entries()</code> (and <code>box_parse_entry()</code>),
and <code>stack_rows_tbl()</code>; this would allow someone to access
the Box API themselves, much-more-easily.</p>
<p>Of course, the functions would have better-thought-out names, and
would be more complicated themselves. However, the areas of
responsibility for each function would be the same.</p>
</div>
</div>
<div class="section level2">
<h2 id="questions-and-lingering-issues">Questions and lingering issues<a class="anchor" aria-label="anchor" href="#questions-and-lingering-issues"></a>
</h2>
<p>What should be the canonical form of data that we return?</p>
<ul>
<li>I can see an argument for the tibble, given that we are
Tidyverse-friendly already. I can also see the appeal of keeping things
nested.</li>
<li>I can also appreciate the appeal of the data frame, as Nate put it:
“The US Dollar of data analysis”.</li>
<li>Should we pick one of these, we can always provide a selection of
helpers, e.g. <code>box_tibble()</code>, <code>box_nest()</code>,
<code>box_unnest()</code>, <code>box_data_frame()</code>. These
functions could be used to translate among the formats.</li>
</ul>
<p>One way that we can avoid “breaking changes” is to create a new
function with a new name for the new functionality. We can then
“supersede” or “deprecate” the old function.</p>
<p>The problem comes when an old function has a really good name.</p>
</div>
<div class="section level2">
<h2 id="documentation-normalization">Documentation normalization<a class="anchor" aria-label="anchor" href="#documentation-normalization"></a>
</h2>
<p>Another thing we would like to do is to make the documentation
simpler for us to maintain. With this release, we take two steps in that
direction:</p>
<ul>
<li>
<p>an internal function <code>string_side_effects()</code>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">boxr</span><span class="fu">:::</span><span class="fu">string_side_effects</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Invisible `NULL`, called for side effects."</span></span></code></pre></div>
<p>This is useful to specify a return value:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @return `r string_side_effects()`</span></span></code></pre></div>
</li>
<li>
<p>canonical parameter-definitions:</p>
<ul>
<li>
<code><a href="../reference/box_browse.html">box_browse()</a></code>: <code>file_id</code>,
<code>dir_id</code>
</li>
<li>
<code><a href="../reference/box_dl.html">box_dl()</a></code>: <code>local_dir</code>,
<code>file_name</code>, <code>overwrite</code>, <code>version_id</code>,
<code>version_no</code> (<code>file_id</code> also available)</li>
<li>
<code><a href="../reference/box_dl.html">box_ul()</a></code>: <code>description</code> (<code>dir_id</code>
also available)</li>
</ul>
<p>This cuts down on the possibilities for invoking different functions
when we need only invoke one or two:</p>
<pre><code><span><span class="co">#' @inheritParams box_browse</span></span></code></pre>
</li>
</ul>
<p>As we notice more duplication, we can add to this section.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Brendan Rocks, Ian Lyttle, Nathan Day.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
