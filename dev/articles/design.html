<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Design Philosophy • boxr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Design Philosophy">
<meta property="og:description" content="boxr">
<meta property="og:image" content="/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">boxr</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.3.6.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/boxr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Box Apps</li>
    <li>
      <a href="../articles/boxr-apps.html">Box Apps: Overview</a>
    </li>
    <li>
      <a href="../articles/boxr-app-interactive.html">Box Interactive-Apps</a>
    </li>
    <li>
      <a href="../articles/boxr-app-service.html">Box Service-Apps</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/design.html">Design Philosophy</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-box/boxr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="design_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Design Philosophy</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-box/boxr/blob/master/vignettes/design.Rmd"><code>vignettes/design.Rmd</code></a></small>
      <div class="hidden name"><code>design.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tibble.tidyverse.org/">"tibble"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://arxiv.org/abs/1403.2805">"jsonlite"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://purrr.tidyverse.org">"purrr"</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'purrr'</span>
<span class="co">#&gt; The following object is masked from 'package:jsonlite':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     flatten</span></code></pre></div>
<p>The audience for this article is the developers of <strong>boxr</strong>, who may let many weeks or months pass without actively thinking about how the functions in this package:</p>
<ul>
<li>
<em>are</em> set up; there is some variation here</li>
<li>
<em>could be</em> set up; Ian still argues with himself here, approaching with a different view every time he works on this repository.</li>
</ul>
<p>At its heart, the goal of this package is to abstract away the complexities of using the Box API. We assume that a new user starts using this package with some familiarity with the Tidyverse, and r-lib packages like <strong>fs</strong>, so we aim to provide them with a familiar way of doing things.</p>
<p>Providing familiarity, particularly to emulate an opinionated framework like Tidyverse, requires us (as boxr developers) to introduce opinions. Thus, we also wish provide an “escape hatch”, which could be used by those who want to work outside of the Tidyverse, or outside of our opinions.</p>
<p>In Tidyverse, the base unit of analysis is the data frame. Among the boxr’s developers, it is uncontroversial that we should use data frames as much as possible. However, data frames come in different flavors:</p>
<ul>
<li>use <strong>tibble</strong>, or no.</li>
<li>use nested data frames, or no.</li>
</ul>
<div id="detour-into-postels-law" class="section level2">
<h2 class="hasAnchor">
<a href="#detour-into-postels-law" class="anchor"></a>Detour into Postel’s Law</h2>
<p>I (Ian) am a firm believer that following Postel’s Law helps us (and our users) avoid hard-to-diagnose trouble. As you may know, Postel’s law says to be “flexible in what you accept; strict in what you return”. In other words, we should strive to accept and interpret users’ input so long as the intent is clear, but we should specify very clearly what a function returns and adhere strictly to that specification.</p>
<p>A famous Tidyverse example is how a subsetting a <code>data.frame</code> will, by default, return a <code>vector</code> rather than a <code>data.frame</code> if only one column is specified:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"wt"</span>, <span class="st">"mpg"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    32 obs. of  2 variables:</span>
<span class="co">#&gt;  $ wt : num  2.62 2.88 2.32 3.21 3.44 ...</span>
<span class="co">#&gt;  $ mpg: num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span>, <span class="st">"mpg"</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;  num [1:32] 21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...</span></code></pre></div>
<p>To avoid this behavior you can specify <code>drop = FALSE</code>, but this is sometimes forgotten – even by experienced R users:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span>, <span class="st">"mpg"</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    32 obs. of  1 variable:</span>
<span class="co">#&gt;  $ mpg: num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...</span></code></pre></div>
<p>The tibble designs this problem away. Following Postel’s law, a subsetting a tibble <em>always</em> returns a tibble; if you want a vector, you have to call another function. It is strict with its output.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span><span class="op">[</span>, <span class="st">"mpg"</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; tibble [32 × 1] (S3: tbl_df/tbl/data.frame)</span>
<span class="co">#&gt;  $ mpg: num [1:32] 21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...</span></code></pre></div>
<p>As we figure out what our functions return, I want to keep Postel’s Law in mind.</p>
</div>
<div id="box-api" class="section level2">
<h2 class="hasAnchor">
<a href="#box-api" class="anchor"></a>Box API</h2>
<p>The boxr package is an exercise in abstracting away the Box API; sometimes this abstraction helps developers like me forget that it is actually there. It’s <a href="https://developer.box.com/reference/">there</a>.</p>
<p>The API is classified according to <em>endpoints</em> and <em>resources</em>; I think of these as analogous to R <em>functions</em> and <em>objects</em>. The Box API is comprehensive; we cannot possibly aspire to cover it all. Instead, our goal is to provide easy access to as many day-to-day endpoints as we can, and provide a way to help <em>you</em> to access others if you need to.</p>
<p>Some of our functions call to only one endpoint, e.g. <code><a href="../reference/box_ls.html">box_ls()</a></code> calls only the <a href="https://developer.box.com/reference/get-folders-id-items/#request">list items in folder endpoint</a>. Others of our functions call multiple endpoints, e.g <code><a href="../reference/box_fetch.html">box_fetch()</a></code> calls the list-items endpoint, as well as the <a href="https://developer.box.com/reference/get-files-id-content/">download file endpoint</a>.</p>
<p>If a function calls a single endpoint (perhaps even repeatedly), it should return the response (or collection of responses) that the API returns. Consider the content of a sample response from the <a href="https://developer.box.com/reference/resources/items/">list-items endpoint</a>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">content</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">fromJSON</a></span><span class="op">(</span>
    <span class="st">'{
      "entries": [
        {
          "id": "12345",
          "etag": "1",
          "type": "file",
          "sequence_id": "3",
          "name": "Contract.pdf",
          "sha1": "85136C79CBF9FE36BB9D05D0639C70C265C18D37",
          "file_version": {
            "id": "12345",
            "type": "file_version",
            "sha1": "134b65991ed521fcfe4724b7d814ab8ded5185dc"
          }
        }
      ],
      "limit": 1000,
      "offset": 2000,
      "order": [
        {
          "by": "type",
          "direction": "ASC"
        }
      ],
      "total_count": 5000
    }'</span>,
    simplifyVector <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span></code></pre></div>
<p>The sample response shown on the Box web-page is different from the response that I actually get. The example JSON, in the <code>"entries"</code> element, does not quote numeric values, e.g. <code>{"id": 0}</code>, whereas the <em>actual</em> response does quote numeric values, e.g. <code>{"id": "0"}</code>.</p>
<p>While this may seem inconvenient, it may help us out because although elements like file <code>id</code> are nominally integers, they are often larger than R’s integer-maximum. For this reason, I think that from boxr’s perspective, <code>id</code> should remain a character string. That said, I think we can parse other things:</p>
<ul>
<li>other, smaller, numbers as integers, in this case <code>"etag"</code>, <code>"sequence_id"</code>.</li>
<li>datetimes, these are elements that seem to end with <code>"_at"</code>.</li>
<li>logicals; these are elements that seem to start with <code>"is_"</code>, <code>"can_"</code>, or <code>"has_"</code>.</li>
</ul>
<p>Here’s the parsed content.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">content</span><span class="op">)</span>
<span class="co">#&gt; List of 5</span>
<span class="co">#&gt;  $ entries    :List of 1</span>
<span class="co">#&gt;   ..$ :List of 7</span>
<span class="co">#&gt;   .. ..$ id          : chr "12345"</span>
<span class="co">#&gt;   .. ..$ etag        : chr "1"</span>
<span class="co">#&gt;   .. ..$ type        : chr "file"</span>
<span class="co">#&gt;   .. ..$ sequence_id : chr "3"</span>
<span class="co">#&gt;   .. ..$ name        : chr "Contract.pdf"</span>
<span class="co">#&gt;   .. ..$ sha1        : chr "85136C79CBF9FE36BB9D05D0639C70C265C18D37"</span>
<span class="co">#&gt;   .. ..$ file_version:List of 3</span>
<span class="co">#&gt;   .. .. ..$ id  : chr "12345"</span>
<span class="co">#&gt;   .. .. ..$ type: chr "file_version"</span>
<span class="co">#&gt;   .. .. ..$ sha1: chr "134b65991ed521fcfe4724b7d814ab8ded5185dc"</span>
<span class="co">#&gt;  $ limit      : int 1000</span>
<span class="co">#&gt;  $ offset     : int 2000</span>
<span class="co">#&gt;  $ order      :List of 1</span>
<span class="co">#&gt;   ..$ :List of 2</span>
<span class="co">#&gt;   .. ..$ by       : chr "type"</span>
<span class="co">#&gt;   .. ..$ direction: chr "ASC"</span>
<span class="co">#&gt;  $ total_count: int 5000</span></code></pre></div>
<p>In the <code>content</code> list, only the <code>entries</code> element has lasting information; the other elements deal with the pagination.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># we could imagine this as a function that would contain all our parsing rules</span>
<span class="va">parse_entry</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">entry</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co"># if we import tidyselect, we can use functions like `ends_with()`</span>
  <span class="va">entry</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_if.html">map_at</a></span><span class="op">(</span><span class="va">entry</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"etag"</span>, <span class="st">"sequence_id"</span><span class="op">)</span>, <span class="va">as.numeric</span><span class="op">)</span>
  <span class="va">entry</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_if.html">map_if</a></span><span class="op">(</span><span class="va">entry</span>, <span class="va">is.list</span>, <span class="va">parse_entry</span><span class="op">)</span>
  
  <span class="va">entry</span>
<span class="op">}</span>

<span class="va">entries</span> <span class="op">&lt;-</span>
  <span class="va">content</span><span class="op">$</span><span class="va">entries</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">parse_entry</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">entries</span><span class="op">)</span>
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ :List of 7</span>
<span class="co">#&gt;   ..$ id          : chr "12345"</span>
<span class="co">#&gt;   ..$ etag        : num 1</span>
<span class="co">#&gt;   ..$ type        : chr "file"</span>
<span class="co">#&gt;   ..$ sequence_id : num 3</span>
<span class="co">#&gt;   ..$ name        : chr "Contract.pdf"</span>
<span class="co">#&gt;   ..$ sha1        : chr "85136C79CBF9FE36BB9D05D0639C70C265C18D37"</span>
<span class="co">#&gt;   ..$ file_version:List of 3</span>
<span class="co">#&gt;   .. ..$ id  : chr "12345"</span>
<span class="co">#&gt;   .. ..$ type: chr "file_version"</span>
<span class="co">#&gt;   .. ..$ sha1: chr "134b65991ed521fcfe4724b7d814ab8ded5185dc"</span></code></pre></div>
<p>Here’s where things get interesting.</p>
<p>As it stands, many of boxr’s functions, e.g <code><a href="../reference/box_ls.html">box_ls()</a></code> will return the <code>entries</code> as a list of lists, attaching the S3 class <code>boxr_object_list</code>. It is minimally processed, allowing you to do with it as you please.</p>
<p>This S3 class has an <code><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame()</a></code> method which will convert the element into a data frame. (If you want a data frame 99% of the time, it is inconvenient to call <code><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame()</a></code> 99% of the time.)</p>
<p>It behaves much like the internal function we have, <code>stack_rows_df()</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">boxr</span><span class="fu">:::</span><span class="fu">stack_rows_df</span><span class="op">(</span><span class="va">entries</span><span class="op">)</span>
<span class="co">#&gt;      id etag type sequence_id         name</span>
<span class="co">#&gt; 1 12345    1 file           3 Contract.pdf</span>
<span class="co">#&gt;                                       sha1 file_version.id file_version.type</span>
<span class="co">#&gt; 1 85136C79CBF9FE36BB9D05D0639C70C265C18D37           12345      file_version</span>
<span class="co">#&gt;                          file_version.sha1</span>
<span class="co">#&gt; 1 134b65991ed521fcfe4724b7d814ab8ded5185dc</span></code></pre></div>
<p>For those who prefer tibbles, we have another function, <code>stack_rows_tbl()</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">boxr</span><span class="fu">:::</span><span class="fu">stack_rows_tbl</span><span class="op">(</span><span class="va">entries</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 7</span>
<span class="co">#&gt;   id     etag type  sequence_id name      sha1                    file_version  </span>
<span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;                   &lt;list&gt;        </span>
<span class="co">#&gt; 1 12345     1 file            3 Contract… 85136C79CBF9FE36BB9D05… &lt;named list […</span></code></pre></div>
<p>A couple of things you might notice:</p>
<ul>
<li><p><code>stack_rows_df()</code> returns a <code>data.frame</code>. List items are unnested; the nested item names are delimited with a <code>.</code>, e.g. <code>file_version.id</code>.</p></li>
<li><p><code>stack_rows_tbl()</code> returns a tibble. List items remain nested.</p></li>
</ul>
</div>
<div id="boxr-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#boxr-functions" class="anchor"></a>boxr functions</h2>
<p>Right now, we have a few different ways to deal with return objects:</p>
<ul>
<li>
<code><a href="../reference/box_version_history.html">box_version_history()</a></code>: calls a single endpoint, returns a data frame, but we modify the columns: combining <code>type</code> and <code>id</code> into <code>version_id</code>.</li>
<li>
<code><a href="../reference/box_collab_create.html">box_collab_create()</a></code>: calls a single endpoint, returns a list with an S3 class <code>"boxr_collab"</code>. This S3 class has an <code><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame()</a></code> method, and an <code><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble()</a></code> method.</li>
<li>
<code><a href="../reference/box_ls.html">box_ls()</a></code>: calls a single endpoint, returns a list with an S3 class <code>"boxr_object_list"</code>. This S3 class has an <code><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame()</a></code> method.</li>
<li>
<code><a href="../reference/box_fetch.html">box_fetch()</a></code>: calls multiple endpoints, returns a list with an S3 class <code>"boxr_dir_wide_operation_result"</code>. This S3 class does not have an <code><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame()</a></code> method.</li>
</ul>
<p>The goal is to find a way to harmonize this, without causing too many backward incompatibilities.</p>
</div>
<div id="ideas-for-how-to-proceed" class="section level2">
<h2 class="hasAnchor">
<a href="#ideas-for-how-to-proceed" class="anchor"></a>Ideas for how to proceed</h2>
<p>I’m thinking out loud here to sketch out ways to proceed so that we provide a consistent return object:</p>
<ul>
<li>day-to-day users receive a data-frame-like return object, in some “optimally-wrangled” form.</li>
<li>other users can emulate the process and get the information they need.</li>
</ul>
<p>We will walk through a simplified reimagining of the <code><a href="../reference/box_ls.html">box_ls()</a></code> function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/r-box/boxr/">"boxr"</a></span><span class="op">)</span>

<span class="fu"><a href="../reference/box_auth.html">box_auth</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>Using `BOX_CLIENT_ID` from environment
Using `BOX_CLIENT_SECRET` from environment
boxr: Authenticated using OAuth2 as Ian LYTTLE (ian.lyttle@se.com, id: 196942982)</code></pre>
<div id="single-function-to-call-the-api" class="section level3">
<h3 class="hasAnchor">
<a href="#single-function-to-call-the-api" class="anchor"></a>Single function to call the API</h3>
<p>Let’s imagine a single function in the package that calls the API. It will be more involved than this, but it will give you an idea.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># this works for Ian's Box account - no-one else</span>
<span class="va">dir_id</span> <span class="op">&lt;-</span> <span class="st">"123053109701"</span>

<span class="co"># returns a httr response object</span>
<span class="va">box_api_response</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">verb</span>, <span class="va">endpoint</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">response</span> <span class="op">&lt;-</span>
    <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/RETRY.html">RETRY</a></span><span class="op">(</span>
      <span class="va">verb</span>,
      <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"https://api.box.com/2.0/{endpoint}"</span><span class="op">)</span>,
      <span class="fu">boxr</span><span class="fu">:::</span><span class="fu">get_token</span><span class="op">(</span><span class="op">)</span>,
      terminate_on <span class="op">=</span> <span class="fu">boxr</span><span class="fu">:::</span><span class="fu">box_terminal_http_codes</span><span class="op">(</span><span class="op">)</span>
    <span class="op">)</span>
  
  <span class="va">response</span>  
<span class="op">}</span>

<span class="va">response</span> <span class="op">&lt;-</span> <span class="fu">box_api_response</span><span class="op">(</span><span class="st">"GET"</span>, <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"folders/{dir_id}/items/"</span><span class="op">)</span><span class="op">)</span>

<span class="va">response</span></code></pre></div>
<pre><code>Response [https://api.box.com/2.0/folders/123053109701/items/]
  Date: 2020-10-17 01:04
  Status: 200
  Content-Type: application/json
  Size: 640 B</code></pre>
</div>
<div id="extract-content" class="section level3">
<h3 class="hasAnchor">
<a href="#extract-content" class="anchor"></a>Extract content</h3>
<p>At this point, we have no idea if the response is any good or not, nor have we extracted the content.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">box_content</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">response</span>, <span class="va">task</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/stop_for_status.html">stop_for_status</a></span><span class="op">(</span><span class="va">response</span>, task <span class="op">=</span> <span class="va">task</span><span class="op">)</span>

  <span class="va">text</span> <span class="op">&lt;-</span> <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/content.html">content</a></span><span class="op">(</span><span class="va">response</span>, as <span class="op">=</span> <span class="st">"text"</span>, encoding <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span>
  
  <span class="co"># we may want to deviate from the defaults</span>
  <span class="va">content</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">fromJSON</a></span><span class="op">(</span><span class="va">text</span>, simplifyDataFrame <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  
  <span class="va">content</span>
<span class="op">}</span></code></pre></div>
<p>This lets someone get a JSON list, or an error message if the response is bad.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">content</span> <span class="op">&lt;-</span> <span class="fu">box_content</span><span class="op">(</span><span class="va">response</span>, task <span class="op">=</span> <span class="st">"get directory listing"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">content</span><span class="op">)</span></code></pre></div>
<pre><code>List of 5
 $ total_count: int 2
 $ entries    :List of 2
  ..$ :List of 7
  .. ..$ type        : chr "file"
  .. ..$ id          : chr "721629732867"
  .. ..$ file_version:List of 3
  .. .. ..$ type: chr "file_version"
  .. .. ..$ id  : chr "767453805267"
  .. .. ..$ sha1: chr "c66f70f6c65f8cd381434a56165640d50fb3a9c2"
  .. ..$ sequence_id : chr "0"
  .. ..$ etag        : chr "0"
  .. ..$ sha1        : chr "c66f70f6c65f8cd381434a56165640d50fb3a9c2"
  .. ..$ name        : chr "another-attempt-at-dark-mode.pdf"
  ..$ :List of 7
  .. ..$ type        : chr "file"
  .. ..$ id          : chr "721628453889"
  .. ..$ file_version:List of 3
  .. .. ..$ type: chr "file_version"
  .. .. ..$ id  : chr "767454763288"
  .. .. ..$ sha1: chr "69ad086c3f8d96b991b8f8bcce67b95708397b1a"
  .. ..$ sequence_id : chr "2"
  .. ..$ etag        : chr "2"
  .. ..$ sha1        : chr "69ad086c3f8d96b991b8f8bcce67b95708397b1a"
  .. ..$ name        : chr "ctz-widget.txt"
 $ offset     : int 0
 $ limit      : int 100
 $ order      :List of 2
  ..$ :List of 2
  .. ..$ by       : chr "type"
  .. ..$ direction: chr "ASC"
  ..$ :List of 2
  .. ..$ by       : chr "name"
  .. ..$ direction: chr "ASC"</code></pre>
</div>
<div id="parse-content" class="section level3">
<h3 class="hasAnchor">
<a href="#parse-content" class="anchor"></a>Parse content</h3>
<p>Now, it may be interesting to parse the content into a list. We can use the <code>parse_entry()</code> function from above. Note that some endpoints return an <code>entries</code> element, others don’t. This one does.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">box_parse_entries</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">entries</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">entries</span>, <span class="va">parse_entry</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">parsed</span> <span class="op">&lt;-</span> <span class="fu">box_parse_entries</span><span class="op">(</span><span class="va">content</span><span class="op">$</span><span class="va">entries</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">parsed</span><span class="op">)</span></code></pre></div>
<pre><code>List of 2
 $ :List of 7
  ..$ type        : chr "file"
  ..$ id          : chr "721629732867"
  ..$ file_version:List of 3
  .. ..$ type: chr "file_version"
  .. ..$ id  : chr "767453805267"
  .. ..$ sha1: chr "c66f70f6c65f8cd381434a56165640d50fb3a9c2"
  ..$ sequence_id : num 0
  ..$ etag        : num 0
  ..$ sha1        : chr "c66f70f6c65f8cd381434a56165640d50fb3a9c2"
  ..$ name        : chr "another-attempt-at-dark-mode.pdf"
 $ :List of 7
  ..$ type        : chr "file"
  ..$ id          : chr "721628453889"
  ..$ file_version:List of 3
  .. ..$ type: chr "file_version"
  .. ..$ id  : chr "767454763288"
  .. ..$ sha1: chr "69ad086c3f8d96b991b8f8bcce67b95708397b1a"
  ..$ sequence_id : num 2
  ..$ etag        : num 2
  ..$ sha1        : chr "69ad086c3f8d96b991b8f8bcce67b95708397b1a"
  ..$ name        : chr "ctz-widget.txt"</code></pre>
</div>
<div id="stack-in-tabular-form" class="section level3">
<h3 class="hasAnchor">
<a href="#stack-in-tabular-form" class="anchor"></a>Stack in tabular form</h3>
<p>The parsed content (here at least) is a list of lists. We can stack this into a tibble from the parsed info:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu">boxr</span><span class="fu">:::</span><span class="fu">stack_rows_tbl</span><span class="op">(</span><span class="va">parsed</span><span class="op">)</span>

<span class="va">tbl</span></code></pre></div>
<pre><code># A tibble: 2 x 7
  type  id        file_version   sequence_id  etag sha1                    name               
  &lt;chr&gt; &lt;chr&gt;     &lt;list&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;chr&gt;              
1 file  72162973… &lt;named list […           0     0 c66f70f6c65f8cd381434a… another-attempt-at…
2 file  72162845… &lt;named list […           2     2 69ad086c3f8d96b991b8f8… ctz-widget.txt </code></pre>
</div>
<div id="wrangle" class="section level3">
<h3 class="hasAnchor">
<a href="#wrangle" class="anchor"></a>Wrangle</h3>
<p>For this function, we do not propose any post-processing of the stacked content. However, <code><a href="../reference/box_version_history.html">box_version_history()</a></code> does this: combining <code>type</code> and <code>id</code> into <code>version_id</code>.</p>
</div>
<div id="all-together" class="section level3">
<h3 class="hasAnchor">
<a href="#all-together" class="anchor"></a>All together</h3>
<p>We now have the building blocks for our reimagined <code><a href="../reference/box_ls.html">box_ls()</a></code> function:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">box_dir_info</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dir_id</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">response</span> <span class="op">&lt;-</span> <span class="fu">box_api_response</span><span class="op">(</span><span class="st">"GET"</span>, <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"folders/{dir_id}/items/"</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">entries</span> <span class="op">&lt;-</span> <span class="fu">box_content</span><span class="op">(</span><span class="va">response</span>, task <span class="op">=</span> <span class="st">"get directory listing"</span><span class="op">)</span><span class="op">[[</span><span class="st">"entries"</span><span class="op">]</span><span class="op">]</span>
  
  <span class="co"># The above is an oversimplification. In actuality, these two functions </span>
  <span class="co"># would be combined into one function that would take care of the pagination, </span>
  <span class="co"># something like:</span>
  <span class="co">#</span>
  <span class="co"># entries &lt;- </span>
  <span class="co">#  box_api_entries(</span>
  <span class="co">#    "GET", </span>
  <span class="co">#     endpoint = glue::glue("folders/{dir_id}/items/"),</span>
  <span class="co">#     task = "get directory listing"</span>
  <span class="co">#  )</span>
  <span class="co">#</span>
  <span class="co"># box_api_entries() would call box_api_response() and box_content()</span>
  
  <span class="va">parsed</span> <span class="op">&lt;-</span> <span class="fu">box_parse_entries</span><span class="op">(</span><span class="va">entries</span><span class="op">)</span>
  
  <span class="va">stacked</span> <span class="op">&lt;-</span> <span class="fu">boxr</span><span class="fu">:::</span><span class="fu">stack_rows_tbl</span><span class="op">(</span><span class="va">parsed</span><span class="op">)</span>
  
  <span class="co"># not doing anything here, but box_version_history() changes some columns</span>
  <span class="va">wrangled</span> <span class="op">&lt;-</span> <span class="va">stacked</span>
  
  <span class="va">wrangled</span>
<span class="op">}</span>

<span class="fu">box_dir_info</span><span class="op">(</span><span class="va">dir_id</span><span class="op">)</span></code></pre></div>
<pre><code># A tibble: 2 x 7
  type  id        file_version   sequence_id  etag sha1                    name               
  &lt;chr&gt; &lt;chr&gt;     &lt;list&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;chr&gt;              
1 file  72162973… &lt;named list […           0     0 c66f70f6c65f8cd381434a… another-attempt-at…
2 file  72162845… &lt;named list […           2     2 69ad086c3f8d96b991b8f8… ctz-widget.txt </code></pre>
<p>There are five distinct steps, each of which could be adapted to particular circumstances, each of which could be exposed to the user so they can “roll their own”:</p>
<ul>
<li><p>get the response from the Box API.</p></li>
<li><p>check the response and extract the content.</p></li>
<li><p>parse the content (convert strings to datetimes, etc.).</p></li>
<li><p>stack the parsed content into a canonical tabular form (data frame or tibble).</p></li>
<li><p>wrangle the stacked content (rename columns, etc.).</p></li>
</ul>
<p>Also, there would be three “families” of functions:</p>
<ul>
<li>those that make potentially multiple calls to a single endpoint, but response has <code>entries</code> (implying pagination), e.g. <code><a href="../reference/box_ls.html">box_ls()</a></code>.</li>
<li>those that make a single call to a single endpoint, e.g. <code><a href="../reference/box_collab_create.html">box_collab_create()</a></code>.</li>
<li>those that make all sorts of calls to all sorts of endpoints, e.g. <code><a href="../reference/box_fetch.html">box_fetch()</a></code>.</li>
</ul>
<p>The point of this vignette, in its current form, is to sketch out how the first two families might work. The third family will require more consideration and considerably more coffee.</p>
<p>This could simplify the creation of new box functions, and perhaps let us simplify some existing ones. We could export <code>box_api_response()</code>, <code>box_content()</code>, <code>box_parse_entries()</code> (and <code>box_parse_entry()</code>), and <code>stack_rows_tbl()</code>; this would allow someone to access the Box API themselves, much-more-easily.</p>
<p>Of course, the functions would have better-thought-out names, and would be more complicated themselves. However, the areas of responsibility for each function would be the same.</p>
</div>
</div>
<div id="questions-and-lingering-issues" class="section level2">
<h2 class="hasAnchor">
<a href="#questions-and-lingering-issues" class="anchor"></a>Questions and lingering issues</h2>
<p>What should be the canonical form of data that we return?</p>
<ul>
<li>I can see an argument for the tibble, given that we are Tidyverse-friendly already. I can also see the appeal of keeping things nested.</li>
<li>I can also appreciate the appeal of the data frame, as Nate put it: “The US Dollar of data analysis”.</li>
<li>Should we pick one of these, we can always provide a selection of helpers, e.g. <code>box_tibble()</code>, <code>box_nest()</code>, <code>box_unnest()</code>, <code>box_data_frame()</code>. These functions could be used to translate among the formats.</li>
</ul>
<p>One way that we can avoid “breaking changes” is to create a new function with a new name for the new functionality. We can then “supersede” or “deprecate” the old function.</p>
<p>The problem comes when an old function has a really good name.</p>
</div>
<div id="documentation-normalization" class="section level2">
<h2 class="hasAnchor">
<a href="#documentation-normalization" class="anchor"></a>Documentation normalization</h2>
<p>Another thing we would like to do is to make the documentation simpler for us to maintain. With this release, we take two steps in that direction:</p>
<ul>
<li>
<p>an internal function <code>string_side_effects()</code>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">boxr</span><span class="fu">:::</span><span class="fu">string_side_effects</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "Invisible `NULL`, called for side effects."</span></code></pre></div>
<p>This is useful to specify a return value:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' @return `r string_side_effects()`</span></code></pre></div>
</li>
<li>
<p>canonical parameter-definitions:</p>
<ul>
<li>
<code><a href="../reference/box_browse.html">box_browse()</a></code>: <code>file_id</code>, <code>dir_id</code>
</li>
<li>
<code><a href="../reference/box_dl.html">box_dl()</a></code>: <code>local_dir</code>, <code>file_name</code>, <code>overwrite</code>, <code>version_id</code>, <code>version_no</code> (<code>file_id</code> also available)</li>
<li>
<code><a href="../reference/box_dl.html">box_ul()</a></code>: <code>description</code> (<code>dir_id</code> also available)</li>
</ul>
<p>This cuts down on the possibilities for invoking different functions when we need only invoke one or two:</p>
<pre><code>#' @inheritParams box_browse</code></pre>
</li>
</ul>
<p>As we notice more duplication, we can add to this section.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Brendan Rocks, Ian Lyttle, Nathan Day.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
